@model List<FreelancePlatform.Models.Proje>

@{
    ViewData["Title"] = "Yayınlanan Projeler";
    var userJson = Context.Session.GetString("Kullanici");
    var kullanici = userJson != null
        ? System.Text.Json.JsonSerializer.Deserialize<FreelancePlatform.Models.AppUser>(userJson)
        : null;
    Dictionary<string, decimal> kurKarsiliklari = null;
    if (ViewBag.KurKarsiliklari != null)
    {
        kurKarsiliklari = ViewBag.KurKarsiliklari as Dictionary<string, decimal>;
    }
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />

<style>
    body {
        background: linear-gradient(120deg, #e6f0ff 0%, #f8fafc 100%);
        min-height: 100vh;
    }

    .proje-table th {
        background: #2d6cdf !important;
        color: #fff !important;
        letter-spacing: 0.02em;
        font-size: 1.07rem;
        text-align: center;
        border: none;
    }

    .proje-table td {
        vertical-align: middle !important;
        background: rgba(255,255,255,0.97);
        color: #232b3a;
        font-size: 1.04rem;
        text-align: center;
        border: none;
        box-shadow: 0 1px 0 rgba(220,225,240,0.17);
    }

    .proje-table tr {
        border-radius: 1.1rem;
        box-shadow: 0 4px 16px rgba(45,108,223,0.08);
        transition: box-shadow .15s;
    }

        .proje-table tr:hover td {
            background: #eaf2fc !important;
            box-shadow: 0 6px 24px rgba(45,108,223,0.16);
        }

    .table-action-btn {
        min-width: 110px;
        font-size: .99rem;
        border-radius: 1.7rem;
        font-weight: 600;
        box-shadow: 0 2px 12px rgba(50,120,220,0.11);
        background: linear-gradient(95deg,#2566e8 0%,#37c773 80%);
        border: none;
    }

        .table-action-btn:hover {
            background: linear-gradient(95deg,#37c773 0%,#2566e8 80%);
            color: #fff;
            border: none;
        }

    .badge {
        border-radius: 1.4rem;
        letter-spacing: .02em;
    }

    .proje-card-head {
        font-size: 1.12rem;
        font-weight: 700;
        color: #205e9b;
        display: flex;
        align-items: center;
        gap: 6px;
        margin-bottom: 3px;
    }

    .proje-aciklama {
        font-size: 0.98rem;
        color: #4b515b;
    }
</style>

<h2 class="mb-4 mt-2 text-center fw-bold" style="color:#2d6cdf;">
    <i class="fas fa-briefcase"></i> Yayınlanan Projeler
</h2>

@if (kurKarsiliklari != null)
{
    <div class="alert alert-info shadow-sm text-start w-75 mx-auto">
        <b>@ViewBag.KurAnaTutar @ViewBag.KurAnaParaBirimi</b> tutarının güncel karşılıkları:
        <ul class="mb-0">
            @foreach (var item in kurKarsiliklari)
            {
                if (item.Key != "HATA")
                {
                    <li><b>@item.Key</b>: @item.Value</li>
                }
                else
                {
                    <li><b style="color:red">Döviz kuru alınamadı!</b></li>
                }
            }
        </ul>
    </div>
}

<div class="container px-0 px-md-2 mb-5">
    <div class="table-responsive rounded shadow-sm">
        <table class="table table-hover rounded-4 proje-table align-middle mb-0">
            <thead>
                <tr>
                    <th>Başlık</th>
                    <th>Açıklama</th>
                    <th>Bütçe</th>
                    <th>Para Birimi</th>
                    <th>Tarih</th>
                    <th>Yayınlayan</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var proje in Model)
                {
                    <tr>
                        <td class="proje-card-head">
                            <i class="fas fa-folder-open me-1 text-primary"></i>
                            @proje.Baslik
                        </td>
                        <td class="proje-aciklama">@proje.Aciklama</td>
                        <td>
                            <span class="badge bg-success bg-opacity-75 fs-6">
                                @proje.Butce.ToString("0.00")
                            </span>
                        </td>
                        <td>
                            <span class="badge bg-primary bg-opacity-75 fs-6">
                                @proje.ParaBirimi
                            </span>
                        </td>
                        <td>
                            <span class="badge bg-warning bg-opacity-90 text-dark fs-6">
                                @proje.OlusturmaTarihi.ToString("dd.MM.yyyy HH:mm")
                            </span>
                        </td>
                        <td>
                            <span class="fw-bold">@proje.YayinlayanAdSoyad</span><br />
                            <small class="text-secondary">@proje.YayınlayanEmail</small>
                        </td>
                        <td>
                            @if (kullanici != null && kullanici.Rol == "Freelancer")
                            {
                                <a href="/Basvuru/Basvur?projeId=@proje.ProjeID" class="btn btn-primary btn-sm table-action-btn">
                                    <i class="fas fa-paper-plane"></i> Başvur
                                </a>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
